import tensorflow as tf

def box_iou(b1, b2):
    # shape of (num_anchors, 1, 4)
    b1    = tf.expand_dims(b1, -2)
    b1_xy = b1[..., :2]
    b1_wh = b1[..., 2:4]
    b1_wh_half = b1_wh / 2.
    b1_mins  = b1_xy - b1_wh_half
    b1_maxes = b1_xy + b1_wh_half

    # shape of (1, n, 4)
    b2    = tf.expand_dims(b2, 0)
    b2_xy = b2[..., :2]
    b2_wh = b2[..., 2:4]
    b2_wh_half = b2_wh / 2.
    b2_mins  = b2_xy - b2_wh_half
    b2_maxes = b2_xy + b2_wh_half

    intersect_mins  = tf.maximum(b1_mins, b2_mins)
    intersect_maxes = tf.minimum(b1_maxes, b2_maxes)
    intersect_wh    = tf.maximum(intersect_maxes - intersect_mins, 0.)
    intersect_area  = intersect_wh[..., 0] * intersect_wh[..., 1]
    b1_area = b1_wh[..., 0] * b1_wh[..., 1]
    b2_area = b2_wh[..., 0] * b2_wh[..., 1]
    iou     = intersect_area / (b1_area + b2_area - intersect_area)

    return iou

def decode(feats, anchors, num_classes, input_shape, train):
    pass
